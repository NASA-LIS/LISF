### Metric scripts for hydrologic forecasts ###
###############################################

## The following set of scripts processes metrics for individual
## NMME model's LIS based hydrologic monthly forecasts out to 9 months for 
## a given month and year's initial condition.
##
## The input file "lis_postproc_metric_s2s_use-case_input_v74.tar.gz" contains
## October 2008-2020 to June 2009-2021 monthly hindcast files and a proxy 
## October 2020 to June 2021 monthly forecasts for CFSv2. 
## This tar.gz file is the subset of monthly files in
## "lis_postproc_s2s_use-case_output_v74.tar.gz" in "s2spost" use-case.
##
## This use-case set-up uses CFSv2 Oct 2008-2019 to Jun 2009-2020 hindcast 
## climatological period for CFSv2 Oct 2020 to Jun 2021 forecasts
## to produce forecast metrics - anomaly (ANOM) and standardized anomaly (SANOM)
## The forecast initial condition month and year, hindcast climatological 
## period, the number of lead months, and the NMME models can be easily 
## changed in the main shell script (eg. "for model in CCSM4 GNEMO CFSV2; do").


## The main shell script : "Postprocess_NMME_job.sh"
## sets the run directory, forecast initial condition month and year, 
## along with the hindcast climatological period, lead months and 
## the NMME models that need to be postprocessed for metric evaluation,
## eg. "for model in CFSV2; do"
##
## This is the only script that needs to run on terminal,
## the rest of the associated scripts will follow.
## The embedded path in this script "
## rundir='/discover/nobackup/projects/nca/\
## karsenau/S2S/AFRICOM/share/final_code/lvt/utils/usaf/s2smetric' " 
## will need to be changed depending on the path/directory it is being run in.


## "Postprocess_NMME_job.sh" runs "job_run_convert_Dyn_FCST_to_postproc.scr"
## which loads the python module and passes the python scripts
## to "run_Convert_Dyn_FCST_postproc.scr", which is a SBATCH script.
##
## "job_run_convert_Dyn_FCST_to_postproc.scr" has hardcoded path 
## "SCRIPT='/discover/nobackup/projects/nca/karsenau/S2S/AFRICOM/share/\
## final_code/lvt/utils/usaf/s2smetric/run_Convert_Dyn_FCST_postproc.scr' " 
## which will need to be changed depending on the path/directory 
## it is stored in.
##
## Similarly, in "run_Convert_Dyn_FCST_postproc.scr" the hardcoded path
## "cd /discover/nobackup/projects/nca/karsenau/S2S/AFRICOM/share/final_code/\
## lvt/utils/usaf/s2smetric/lib_bcsd_metrics/" will need to be changed 
## depending on where the metric python codes are stored.

## The sequence of running the postprocessing scripts are as follows:
##
## Postprocess_NMME_job.sh -> job_run_convert_Dyn_FCST_to_postproc.scr ->
## run_Convert_Dyn_FCST_postproc.scr -> convert_dyn_fcst_to_anom.py
##
## Postprocess_NMME_job.sh -> job_run_convert_Dyn_FCST_to_postproc.scr ->
## run_Convert_Dyn_FCST_postproc.scr -> convert_dyn_fcst_to_sanom.py

## "convert_dyn_fcst_to_anom.py" and "convert_dyn_fcst_to_sanom.py"
## use functions from user defined python functions in "All_functions.py". 
## User defined python functions in "Shrad_modules.py" are for futher 
## developmental use.

## The input path will need to be changed in
## "convert_dyn_fcst_to_anom.py" and
## "convert_dyn_fcst_to_sanom.py"
## they are currently hardcoded to read from
## "/discover/nobackup/projects/lis_aist17/emkemp/AFWA/lis74_s2s_cf/"
## These scripts will read the files in ""
##
## The metric output path will also need to be changed in
## convert_dyn_fcst_to_anom.py and
## convert_dyn_fcst_to_sanom.py
## they are currently hardcoded to write into
## "/discover/nobackup/projects/fame/FORECASTS/GEOS5/BCSD_Test/
## NMME_FCST_DATA_AF/DYN_ANOM"
## and 
## "/discover/nobackup/projects/fame/FORECASTS/GEOS5/BCSD_Test/
## NMME_FCST_DATA_AF/DYN_SANOM"
## 
## "convert_dyn_fcst_to_anom.py" and "convert_dyn_fcst_to_sanom.py"
## produce the anomaly and standardized anomaly for forecasts.
## they are currently hardcoded to processes hydrologic outputs:
## Rootzone soil moisture, Surface soil moisture and Streamflow

## The intermediate monthly forecast metric output files for Rootzone and 
## Surface soil moisture, and Streamflow are in 
## "lis_postproc_metric_s2s_use-case_output_v74.tar.gz"

