<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>LIS Public Testcase Walkthrough</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>LIS Public Testcase Walkthrough</h1>
<div class="details">
<span id="revnumber">version 1.1,</span>
<span id="revdate">June 26, 2023</span>
<br><span id="revremark">Updated for LISF Public 7.4 release</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_setup">Setup</a></li>
<li><a href="#_step_1_lsm_parameter_processing_run_ldt">Step 1: LSM Parameter Processing Run (LDT)</a></li>
<li><a href="#_step_2_lsm_open_loop_ol_experiment_lis">Step 2: LSM "Open-loop" (OL) Experiment (LIS)</a></li>
<li><a href="#_step_3_ensemble_restart_file_generation_ldt">Step 3: Ensemble Restart File Generation (LDT)</a></li>
<li><a href="#_step_4_generate_lsm_ol_cumulative_density_function_based_files_ldt">Step 4: Generate LSM OL Cumulative Density Function-based Files (LDT)</a></li>
<li><a href="#_step_5_generate_observations_cdf_based_files_ldt">Step 5: Generate Observations CDF-based Files (LDT)</a></li>
<li><a href="#_step_6_lsm_data_assimilation_da_experiment_lis">Step 6: LSM Data Assimilation (DA) Experiment (LIS)</a></li>
<li><a href="#_step_7_comparison_of_ol_and_da_experiments_lvt">Step 7: Comparison of OL and DA Experiments (LVT)</a></li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://lis.gsfc.nasa.gov">Land Information System framework (LISF)</a> public testcases described in this document provide users a suite of step-by-step experiments to learn how to run and test the LISF code. These experiments include a full end-to-end walkthrough of all three (3) components of the LISF; (1) the Land Data Toolkit (LDT), (2) the Land Information System (LIS), and (3) the Land Verification Toolkit (LVT). These testcases demonstrate how to use LDT to generate model parameter and assimilation-based input files, how to use LIS to run the Noah land surface model (LSM) for a sample "open-loop" (or baseline) experiment and a data assimilation (DA) experiment, and how to use LVT to compare output from the sample experiments. The testcases were created to demonstrate the use of LISF, however, the files provided could be expanded to support research-related model runs.</p>
</div>
<div class="sect2">
<h3 id="_the_testcase_event_snow_blankets_the_southern_great_plains">The Testcase Event: Snow Blankets the Southern Great Plains</h3>
<div class="paragraph">
<p>In late April of 2017, <a href="https://www.weather.gov/gid/apr302017snow">a major snow storm event</a> occurred across the Southern Great Plains (SGP) and Rocky Mountains, an area spanning Colorado, Texas, Oklahoma, and southern Kansas. This storm event will be the focus of these testcases.</p>
</div>
<div class="openblock float-group">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="./images/intro_storm_radar.jpeg" alt="intro storm radar">
</div>
<div class="title">(<a href="https://twitter.com/SteveBowenWx/status/858876054789910528/photo/1">Image source</a>, <a href="https://www.nohrsc.noaa.gov/snowfall_v2/index.html?season=2016-2017&amp;date=2018071912&amp;version=0">Data source</a>)</div>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup">Setup</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have not set up your computing environment to compile and run the LISF code, review the <a href="https://github.com/NASA-LIS/LISF/tree/master/docs" target="_blank" rel="noopener">official documentation</a>.</p>
</div>
<div class="paragraph">
<p>Users on NASA&#8217;s NCCS Discover HPC system should review <em>Quick Start Guide for NCCS Discover Users</em> in <a href="https://github.com/NASA-LIS/LISF/tree/master/docs">our docs</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_create_a_working_directory">Create a working directory</h3>
<div class="paragraph">
<p>To begin, create and step into a working directory that you will use throughout the testcases. This directory will be referred to as <code>$WORKING_DIR</code> from this point forward. In the following example, we create a working directory called <code>lis-public-testcases</code>:</p>
</div>
<div id="create-workingdir" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% mkdir lis-public-testcases
% cd lis-public-testcases</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_clone_the_lisf_repository">Clone the LISF Repository</h3>
<div class="paragraph">
<p>From inside your <code>$WORKING_DIR</code>, clone the public support branch of the <a href="https://github.com/NASA-LIS/LISF">LISF repository</a>:</p>
</div>
<div id="clone-lis" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% git clone -b support/lisf-public-7.4 github:NASA-LIS/LISF.git
% cd LISF</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>support/lisf-public-7.4</code> branch is known to be compatible with the testcase files. The <code>master</code> branch may contain changes to the LISF source code that break compatibility with the testcase files. We therefore recommend using the support branch while working through these testcases.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configure_and_compile_the_lisf_components">Configure and Compile the LISF Components</h3>
<div class="paragraph">
<p>For information about configuration settings and detailed compilation instructions, see the <a href="https://github.com/NASA-LIS/LISF/tree/master/docs" target="_blank" rel="noopener">LISF Users' Guides</a>. In general, the compilation process for each component is as follows:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As you run these testcases, you will have the opportunity to compare your output to TARGET_OUTPUT files or "solutions".  The TARGET_OUTPUT files were created by running ldt, lis, and lvt compiled with <strong>default</strong> compile configuration settings.  For this walkthrough, it is recommended that you also use default compiler configuration settings.
</td>
</tr>
</table>
</div>
<div id="compile-example" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% cd ldt
% ./configure
> # Select compile configuration settings (Default settings recommended.)
% ./compile
> # Compilation output...
% mv LDT ../../            # move executable up into $WORKING_DIR
% cd ..                    # change directories back into LISF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Repeat the above process in the <code>lis/</code> and <code>lvt/</code> directories to generate the <em>LIS</em> and <em>LVT</em> executables.</p>
</div>
<div class="paragraph">
<p>Change directories back into your <code>$WORKING_DIR</code> which should now contain three executable files: <code>LDT</code>, <code>LIS</code>, <code>LVT</code>.</p>
</div>
<div class="paragraph">
<p>If you ever wish to generate new executable files, <code>cd</code> into <code>/LISF/l??/make</code> and run <code>gmake realclean</code>.  This will clear all dependency files and allow you to cleanly define new compile configuration settings and recompile.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_1_lsm_parameter_processing_run_ldt">Step 1: LSM Parameter Processing Run (LDT)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">Overview</h3>
<div class="paragraph">
<p>In this step you will learn how to run LDT to perform parameter processing for the Noah-3.6 land surface model (LSM) and generate a Noah-3.6 parameter input file which will be used by LIS and LVT in later steps.</p>
</div>
<div class="sect3">
<h4 id="_steps_to_running_ldt">Steps to Running LDT</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Gather input data needed by LDT</p>
</li>
<li>
<p>Modify <code>ldt.config</code> file to define runtime configuration settings</p>
</li>
<li>
<p>Run the LDT executable</p>
</li>
<li>
<p>Examine output</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These testcases were designed to be run in sequential order and later steps require the output generated by earlier steps.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_download_input_and_target_files">Download Input and Target Files</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The tar file for this step is approximately <strong>350MB</strong> compressed and <strong>4.2GB</strong> unpacked. Ensure that you have enough storage available before downloading testcase files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The tar files used in this walkthrough are available on the <a href="https://lis.gsfc.nasa.gov/tests/lis">LIS Testcase website</a>. From within your <code>$WORKING_DIR</code>, download and unpack the compressed tar file containing the inputs and target outputs for Step 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% curl -O https://portal.nccs.nasa.gov/lisdata_pub/Tutorials/Web_Version/testcase1_ldt_parms_2023.tar.gz
% tar -xzf testcase1_ldt_parms_2023.tar.gz -C .</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the <code>LISF/</code> directory and the three executables, your <code>$WORKING_DIR</code> should now contain the following directory and files:</p>
</div>
<table class="tableblock frame-ends grid-all stripes-odd fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INPUT/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory that will hold parameter and input files needed throughout the testcases</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldt.config.noah36_params</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The runtime configuration file read by LDT in this step</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_lis_input.nldas.noah36.d01.nc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The "target" NetCDF file generated by LDT in this step</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_log/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory containing the "target" mask-parameter log and the "target" ldt diagnostic file generated by LDT in this step</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Files and directories beginning with <code>target</code> are provided to compare with the output of your run.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_ldt_configuration_file">The LDT Configuration File</h3>
<div class="paragraph">
<p>The LDT configuration file contains input settings used by LDT at run-time to generate input files for LIS. The configuration options are described in depth in the <a href="https://github.com/NASA-LIS/LISF/tree/master/docs" target="_blank" rel="noopener">LDT Users' Guide</a>.</p>
</div>
<div class="paragraph">
<p>Before continuing, review the contents of the LDT configuration file for our LDT-based Noah.3.6 parameter testcase by printing the file contents to the terminal with <code>cat</code> or opening the file with a text editor such as <code>vim</code> or <code>emacs</code>. Key elements of the file are highlighted below:</p>
</div>
<div id="cat-ldt-config" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#Overall driver options
LDT running mode:                   "LSM parameter processing"
Processed LSM parameter filename:   ./lis_input.nldas.noah36.d01.nc <i class="conum" data-value="1"></i><b>(1)</b>
LIS number of nests:                1
Number of surface model types:      2
Surface model types:                "LSM" "Openwater"
Land surface model:                 "Noah.3.6" <i class="conum" data-value="2"></i><b>(2)</b>
...
LDT diagnostic file:                ldtlog <i class="conum" data-value="3"></i><b>(3)</b>
LDT output directory:               OUTPUT <i class="conum" data-value="4"></i><b>(4)</b>
Undefined value:                    -9999.0
...
#LIS domain <i class="conum" data-value="5"></i><b>(5)</b>
Map projection of the LIS domain:  latlon
Run domain lower left lat:         34.375
Run domain lower left lon:         -102.875
Run domain upper right lat:        39.625
Run domain upper right lon:        -96.125
Run domain resolution (dx):        0.25
Run domain resolution (dy):        0.25

# Parameters
Landcover data source:             MODIS_Native <i class="conum" data-value="6"></i><b>(6)</b>
Landcover classification:          IGBPNCEP
Landcover file:                    ./INPUT/LS_PARAMETERS/noah_2dparms/igbp.bin <i class="conum" data-value="6"></i><b>(6)</b>
Landcover spatial transform:       tile
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the NetCDF-formatted parameter file to be generated which will be used by LIS</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The LSM to run (e.g., <a href="https://ral.ucar.edu/solutions/products/unified-noah-lsm">Noah.3.6</a>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The name of the diagnostic log file</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The directory where LDT output will be placed</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The grid projection, domain extents, and spatial resolution to be used by LIS (and LVT)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Data source settings and paths (e.g., landcover datasets, elevation datasets) and additional features of interest (e.g., irrigation settings)</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LISF configuration files use relative paths to describe file locations. Keep this in mind if you encounter any "file not found" errors.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_noah_land_surface_model_parameters">Noah Land Surface Model Parameters</h4>
<div class="paragraph">
<p>As you may have noticed, these testcases utilize NOAA/NCAR&#8217;s Noah LSM, v3.6. The input parameters selected in <code>ldt.config.noah36_params</code> include:</p>
</div>
<table class="tableblock frame-ends grid-all stripes-odd fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Dataset</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Landcover</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MODIS-based IGBP landcover map (~ 1 km, NOAA)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soil texture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FAO+STATSGOv1 combined soil texture map (~ 1 km, NOAA)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greenness fraction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AVHRR-based monthly climatology (1.0 deg, NOAA)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snow-free albedo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monthly climatology dataset (1.0 deg, NOAA)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum snow albedo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MODIS-based maximum snow albedo (0.05 deg; Mike Barlage, NCAR)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bottom of soil column temperature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISLSCP-1 climatology dataset (1.0 deg)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_testcase_domain">Testcase Domain</h4>
<div class="paragraph">
<p>The spatial domain defined in the LDT configuration file will be placed in <code>lis_input.nldas.noah36.d01.nc</code>, the NetCDF-formatted parameter file generated by LDT which LIS will read in automatically at run-time. For these testcases we will be using the domain depicted by the black box on this map:</p>
</div>
<div class="openblock float-group">
<div class="content">
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_1_domain_radar.jpeg" alt="step 1 domain radar">
</div>
<div class="title">Testcase domain</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_ldt_the_parameter_processing_step">Run LDT - The Parameter Processing Step</h3>
<div class="paragraph">
<p>You&#8217;re now ready to run LDT:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy your compiled <strong><em>LDT</em></strong> executable into <code>$WORKING_DIR/</code></p>
</li>
<li>
<p>Run the <strong><em>LDT</em></strong> executable using the provided <code>ldt.config.noah36_params</code> file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ./LDT ldt.config.noah36_params</code></pre>
</div>
</div>
<div class="paragraph">
<p>The run should take a few minutes to complete. If the run aborts, troubleshoot the issue by reviewing any errors printed to the terminal and by viewing the contents of <code>ldtlog.0000</code>. If no errors print to the terminal, verify that the run completed successfully by checking for the following confirmation at the end of the <code>ldtlog.0000</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the terminal reports the error "./LDT: symbol lookup error:", this may be due extraneous modules loaded into your environement that do not allow lis to run properly. View your modules using the command <code>module list</code>.  If extraneous modules are loaded, run <code>module purge</code> to clear your environment and then <code>module load [lisf module file]</code> to load an environment suitable to running LISF.  See the "discover_quick_start" document in the <a href="https://github.com/NASA-LIS/LISF/tree/master/docs" target="_blank" rel="noopener">LISF Users' Guides</a> for more information.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% tail ldtlog.0000
...
 --------------------------------
  Finished LDT run
 --------------------------------</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>ldt, lis, and lvt can also be run by submitting batch jobs using SLURM (<strong>S</strong>imple <strong>L</strong>inux <strong>U</strong>tility for <strong>R</strong>esource <strong>M</strong>anagement).  If you are running this tutorial on Discover, you can download example batch scripts for all steps from the <a href="https://lis.gsfc.nasa.gov/tests/lis">LIS Testcase website</a> using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% curl -O https://portal.nccs.nasa.gov/lisdata_pub/Tutorials/Web_Version/testcase_batch_scripts.tar.gz
% tar -xzf testcase_batch_scripts.tar.gz -C .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The batch scripts (<code>step*.job</code>) will unpack into the appropriate directories. To submit a job to discover using a batch script, use the command <code>sbatch [BATCH SCRIPT]</code> from the same directory as the job you wish to run.  The command <code>squeue -u [YOUR USER ID]</code> will provide updates on your job. If the job crashes, troubleshoot using any <code>slurm.out</code> files.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://www.nccs.nasa.gov/nccs-users/instructional/using-slurm/submit-jobs">NCCS Discover Jobs Users' Guide</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ldt_output_files">LDT Output Files</h3>
<div class="paragraph">
<p>The following files are typically generated by an LDT parameter processing run:</p>
</div>
<table class="tableblock frame-ends grid-all stripes-odd fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lis_input.nldas.noah36.d01.nc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The NetCDF-formatted model parameter file which LIS reads at runtime. <code>d01</code> refers to the indexed domain, typically used as "nests" for NASA-Unified WRF simulations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldtlog.0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The output diagnostic file that provides runtime messages, including warnings and error messages. This file is useful for verifying successful run completion and troubleshooting unsuccessful runs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MaskParamFill.log</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This diagnostic file informs of any disagreements between an LSM-based parameter and the landmask, and whether any parameter gridcells were "filled" to agree with the landmask.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The output filenames for <code>lis_input.nldas.noah36.d01.nc</code> and <code>ldtlog.0000</code> can be defined in the <code>ldt.config</code> file, but the filename of <code>MaskParamFill.log</code> cannot be modified.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_the_lis_parameter_file">The LIS Parameter File</h4>
<div class="paragraph">
<p>The contents of the LIS parameter input file produced by LDT can be examined visually using a command-line program such as <a href="http://meteora.ucsd.edu/~pierce/ncview_home_page.html" target="_blank" rel="noopener"><code>ncview</code></a> or a desktop application like NASA&#8217;s <a href="https://www.giss.nasa.gov/tools/panoply/" target="_blank" rel="noopener">Panoply</a>. For this walkthrough we will be using <code>ncview</code>. If needed, add <code>ncview</code> to your environment by running, <code>module load ncview</code>.</p>
</div>
<div class="paragraph">
<p>Open the LIS input file using <code>ncview</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ncview lis_input.nldas.noah36.d01.nc</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>ncview</code> window that opens, click on the widget labeled <strong>DOMAINMASK</strong>. A second window will open containing a map of the mask. The domain we are using is a simple rectangle so, as expected, all values are equal to <code>1</code>.</p>
</div>
<div class="paragraph">
<p>Click on the widget labeled <strong>LANDMASK</strong>. Again, the values are all equal to <code>1</code>. This indicates that all grid cells within the domain are treated as land and, as a result, the input file should <em>not</em> contain any undefined values (e.g., <code>-9999</code>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/step_1_landmask.png" alt="step 1 landmask">
</div>
<div class="title">LANDMASK dataset</div>
</div>
<div class="paragraph">
<p>Click on the <strong>LANDCOVER</strong> widget to view the landcover variable. In the bottom third of the <code>ncview</code> window, click on the widget below the label <em>Current</em> to cycle through the 20 different <a href="http://www.eomf.ou.edu/static/IGBP.pdf">IGBP landcover and land use classes</a>. In the screenshot below the <em>Crop</em> class is selected (the classes are zero-indexed in <code>ncview</code>; add 1 to index to convert to IGBP class).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/step_1_landcover.png" alt="step 1 landcover">
</div>
<div class="title">The <em>Crop</em> class of the <strong>LANDCOVER</strong> dataset</div>
</div>
<div class="paragraph">
<p>Click on the <strong>TEXTURE</strong> widget to view the soil texture dataset. Click on the widget below the label <em>Current</em>. This is the FAO+STATSGO soil texture map, aggregated using the <code>tile</code> option for the <code>Soil texture spatial transform:</code> setting in <code>ldt.config</code>. The map shows the fraction, or frequencies, of each soil type within each 0.25 degree grid cell of our domain.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/step_1_soil_texture_tile.png" alt="step 1 soil texture tile">
</div>
<div class="title">Soil texture, tile-based aggregation</div>
</div>
<div class="paragraph">
<p>LDT provides several other options for grid cell aggregation including <code>none</code>, <code>mode</code>, and <code>neighbor</code>. What would the output look like if we were to rerun LDT after switching from <code>tile</code> to <code>mode</code>? Open <code>ldt.config.noah36_params</code> in a text editor and change the <code>Soil texture spatial transform</code> option from <code>tile</code> to <code>mode</code> as below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">...
Soil texture spatial transform: mode
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Rerun LDT:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ./LDT ldt.config.noah36_params</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the end of <code>ldtlog.0000</code> to verify LDT ran successfully. Again, open the LIS input file using <code>ncview</code> and click on the <strong>TEXTURE</strong> widget.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/step_1_soil_texture_mode.png" alt="step 1 soil texture mode">
</div>
</div>
<div class="paragraph">
<p>Each soil type now shows a total value of 1 within each 0.25 degree grid cell of our domain. Why? The <code>mode</code> option selects the <em>dominant</em> soil type for each grid cell.</p>
</div>
<div class="paragraph">
<p>For comparison:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/step_1_soil_texture_comparison.png" alt="step 1 soil texture comparison">
</div>
<div class="title">Dominant vs. fractional soil type</div>
</div>
<div class="paragraph">
<p>Another program called <code>ncdump</code> can be used to directly view the datasets contained in NetCDF files. For example, the <code>-h</code> flag can be used to print the dimensions, variable names, and attributes of the file to the terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ncdump -h lis_input.nldas.noah36.d01.nc
netcdf lis_input.nldas.noah36.d01 {
dimensions:
    east_west = 28 ;
    north_south = 22 ;
    east_west_b = 32 ;
    north_south_b = 26 ;
    month = 12 ;
    time = 1 ;
    sfctypes = 21 ;          # Note: 21 includes openwater surface type
    soiltypes = 16 ;
    elevbins = 1 ;
    slopebins = 1 ;
    aspectbins = 1 ;
variables:
    float time(time) ;
    float DOMAINMASK(north_south, east_west) ;
          DOMAINMASK:standard_name = "DOMAINMASK" ;
          DOMAINMASK:units = "" ;
          DOMAINMASK:scale_factor = 1.f ;
          DOMAINMASK:add_offset = 0.f ;
          DOMAINMASK:missing_value = -9999.f;
          DOMAINMASK:vmin = 0.f ;
          DOMAINMASK:vmax = 0.f ;
          DOMAINMASK:num_bins = 1 ;
global attributes:
    :MAP_PROJECTION = "EQUIDISTANT CYLINDRICAL" ;
    :SOUTH_WEST_CORNER_LAT = 34.375f ;
    :SOUTH_WEST_CORNER_LON = -102.875f ;
    :DX = 0.25f ;
    :DY = 0.25f ;
    :INC_WATER_PTS = "true" ;
    :LANDCOVER_SCHEME = "IGBPNCEP" ;
    :BARESOILCLASS = 16 ;
    :URBANCLASS = 13 ;
    :SNOWCLASS = 15 ;
    :WATERCLASS = 17 ;
    :WETLANDCLASS = 11 ;
    :GLACIERCLASS = 15 ;
    :NUMVEGTYPES = 17 ;
    :LANDMASK_SOURCE = "MODIS_Native" ;
    :SFCMODELS = "Noah.3.6+Openwater" ;
    :SOILTEXT_SCHEME = "STATSGO" ;
    :GREENNESS_DATA_INTERVAL = "monthly" ;
    :ALBEDO_DATA_INTERVAL = "monthly" ;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compare_the_output">Compare the Output</h4>
<div class="paragraph">
<p>To further confirm that LDT ran successfully, you can compare your output with the "target" output included with the input files you downloaded earlier (files or directories beginning with <code>target_</code>). For example, use <a href="https://gitlab.com/remikz/nccmp"><code>nccmp</code></a> to compare your <code>lis_input.nldas.noah36.d01.nc</code> with <code>target_lis_input.nldas.noah36.d01.nc</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% nccmp -dfs lis_input.nldas.noah36.d01.nc target_lis_input.nldas.noah36.d01.nc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where the flags <code>d</code>, <code>f</code>, and <code>s</code> enable the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>d</code>: compare data</p>
</li>
<li>
<p><code>f</code>: force comparison to continue after differences found</p>
</li>
<li>
<p><code>s</code>: report identical files to terminal (by default <code>nccmp</code> runs silently if files are identical)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>nccmp</code> command will be used in future steps. Going forward, some files may not be identical, but any differences reported <em>should</em> be small. Also note: in this step, the target lis input file was generated using <code>Soil texture spatial transform: mode</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wrap_up">Wrap-up</h3>
<div class="paragraph">
<p>The LDT parameter processing run generates input parameters and files that LIS requires. Your <code>$WORKING_DIR</code> should now contain all the files needed to continue on to the next step.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_2_lsm_open_loop_ol_experiment_lis">Step 2: LSM "Open-loop" (OL) Experiment (LIS)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_2">Overview</h3>
<div class="paragraph">
<p>In this step you will learn how to run LIS with the Noah-3.6 LSM for an "open-loop" case. This testcase uses the files generated by LDT in Step 1.</p>
</div>
<div class="sect3">
<h4 id="_steps_to_running_lis">Steps to Running LIS</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download input data (e.g., meteorolgical forcing, observations)</p>
</li>
<li>
<p>Modify the <code>lis.config</code> file to select runtime options</p>
</li>
<li>
<p>Run the LIS executable</p>
</li>
<li>
<p>Examine output</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_download_input_and_target_files_2">Download Input and Target Files</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The tar file for this step is approximately <strong>65MB</strong> compressed and <strong>343MB</strong> unpacked. Ensure that you have enough storage available before downloading testcase files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The tar files used in this walkthrough are available on the <a href="https://lis.gsfc.nasa.gov/tests/lis">LIS Testcase website</a>. From within your <code>$WORKING_DIR</code>, download and unpack the compressed tar file containing the inputs and target outputs for Step 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% curl -O https://portal.nccs.nasa.gov/lisdata_pub/Tutorials/Web_Version/testcase2_lis_ol_2023.tar.gz
% tar -xzf testcase2_lis_ol_2023.tar.gz -C .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following files and directories were added to your common working directory, <code>$WORKING_DIR</code>:</p>
</div>
<table class="tableblock frame-ends grid-all stripes-odd fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INPUT/wget_gesdisc_nldas2.sh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A script to download NLDAS2 forcing data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INPUT/NOAH36_OUTPUT_LIST.TBL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Model output specification</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INPUT/forcing_variables.txt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forcing variable specification</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INPUT/LS_PARAMETERS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Model parameter specification</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lis.config_noah36_ol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The runtime configuration file that will be read by LIS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_log/lislog_ol.0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The "target" log file that should be produced by LIS in this step</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_OL_OUTPUT/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory containing containing the "target" open-loop (OL) output files that should be generated by LIS in this step</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_ol.xdf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GrADS descriptor file for visualizing outputs</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_download_the_meteorological_forcing_dataset">Download the Meteorological Forcing Dataset</h4>
<div class="paragraph">
<p>This testcase is set up to use the <a href="https://ldas.gsfc.nasa.gov/nldas/v2/forcing"><em>North American Data Assimilation System, version 2 (NLDAS-2)</em></a> meteorological forcing dataset available from <a href="https://disc.gsfc.nasa.gov/datasets/NLDAS_FORA0125_H_002/summary">NASA GES DISC</a>. A script has been provided in the input files that uses <code>wget</code> to download these data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Users on NASA&#8217;s NCCS Discover HPC system do not need to download the data as described below. Instead, change directories into <code>INPUT/</code> and create a symbolic link to a local copy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ln -s /discover/nobackup/projects/lis/MET_FORCING/NLDAS2.FORCING NLDAS2.FORCING</code></pre>
</div>
</div>
<div class="paragraph">
<p>Jump to the <a href="#_the_lis_configuration_file">next step</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before running the download script:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If needed, install <code>wget</code></p>
</li>
<li>
<p>Create a <a href="https://urs.earthdata.nasa.gov/users/new">NASA Earthdata</a> account if you do not already have one</p>
</li>
<li>
<p>Follow steps 1-3 in <a href="https://disc.gsfc.nasa.gov/data-access#mac_linux_wget">these instructions</a> to save your NASA Earthdata login credentials locally</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you are ready to run the script, change directories into <code>INPUT/</code> and run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% sh wget_gesdisc_nldas2.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script will download NLDAS-2 forcing data for the entire year of 2017 into a directory named <code>NLDAS2.FORCING/</code>. If the script completes without any errors, change up one directory back to your <code>$WORKING_DIR</code>. If any errors are thrown, attempt to resolve them.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_lis_configuration_file">The LIS Configuration File</h3>
<div class="paragraph">
<p>The main LIS configuration file (<code>lis.config_noah36_ol</code>) is where runtime options and filepaths used during the run are defined. These include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The LSM of interest (e.g., Noah.3.6)</p>
</li>
<li>
<p>The name of the NetCDF-parameter file created by LDT in the previous step (e.g., <code>lis_input.nldas.noah36.d01.nc</code>)</p>
</li>
<li>
<p>The name of the LIS diagnostic file (e.g., <code>lislog</code>)</p>
</li>
<li>
<p>The date and time inputs, model options, parallel domain entries, etc.</p>
</li>
<li>
<p>Meteorological forcing dataset(s) selected; also some downscaling features</p>
</li>
<li>
<p>Data assimilation entries, and other features, such as irrigation or runoff routing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Open the LIS configuration file in a text editor to view these settings and more.</p>
</div>
<div class="paragraph">
<p>You may notice that the grid domain is not contained in this file. The grid domain that was defined in the <code>ldt.config</code> file is now contained in the NetCDF-formatted parameter file (<code>lis_input.nldas.noah36.d01.nc</code>) and this information will be read by LIS at runtime.</p>
</div>
</div>
<div class="sect2">
<h3 id="_run_lis_the_open_loop_ol_step">Run LIS - The "Open-Loop" (OL) Step</h3>
<div class="paragraph">
<p>You are now ready to run LIS.</p>
</div>
<div class="paragraph">
<p>In your <code>$WORKING_DIR</code>, execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ./LIS -f lis.config_noah36_ol</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LIS can also be run in parallel. The examples in this walkthrough, however, demonstrate how to run LIS on a single processor. See Chapter 6 in <a href="https://github.com/NASA-LIS/LISF/tree/master/docs">the LIS Users' Guide</a> for instructions for running LIS in parallel.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With a single processor the run should take approximately 20 minutes to complete. If the run fails, diagnose the issue by reviewing any errors that have printed to the terminal and by viewing the contents of <code>lislog</code> files (located in the <code>log</code> directory as defined by line 42 of <code>lis.config_noah36_ol</code>). If no errors appear and the run appears to have completed successfully, examine the end of any <code>lislog</code> files present to check for a confirmation message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% tail lislog.0000
 [INFO] LIS cycle completed
[INFO] LIS cycle time: 01/01/2018 00:00:00
 [INFO] getting file2a..
 ./INPUT/NLDAS2.FORCING/2018/001/NLDAS_FORA0125_H.A20180101.0100.002.grb
 [ERR] Could not find file:
 ./INPUT/NLDAS2.FORCING/2018/001/NLDAS_FORA0125_H.A20180101.0100.002.grb
 [INFO] Noah-3.6 archive restart written:
 ./OL_OUTPUT/SURFACEMODEL/201801/LIS_RST_NOAH36_201801010000.d01.nc

  LIS Run completed.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>ls</code> to view the files and directories created by LIS.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lis_output_files">LIS Output Files</h3>
<div class="paragraph">
<p>The output files created by LIS were placed into a new directory called <code>OL_OUTPUT</code>. Within this directory is another directory called <code>SURFACEMODEL</code> which contains subdirectories following the naming convention <code>YYYYMM</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>YYYY <span class="icon"><i class="fa fa-arrow-right"></i></span> 4-digit year</p>
</li>
<li>
<p>MM <span class="icon"><i class="fa fa-arrow-right"></i></span> 2-digit month</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Within each of those subdirectories are NetCDF-formatted LIS output files that contain the Noah-3.6 output variables defined in <code>NOAH36_OUTPUT_LIST.TBL</code> (e.g., soil moisture, runoff, evapotranspiration). Use any visualization package you are comfortable with to view the files (e.g., Matlab, GrADS, <code>ncview</code>). For GrADS users, descriptor files are provided with the input data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_wrap_up_2">Wrap-up</h3>
<div class="paragraph">
<p>You have now generated your LIS Noah-3.6 model run for the open-loop case. Use <code>diff</code> and <code>nccmp</code> to compare the output files you generated with the "target" versions found in <code>target_OL_OUTPUT/</code>. As in Step 1, the files you generated in this step will be used in later steps.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_3_ensemble_restart_file_generation_ldt">Step 3: Ensemble Restart File Generation (LDT)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_3">Overview</h3>
<div class="paragraph">
<p>In Step 1, you used LDT to perform parameter processing for the Noah-3.6 land surface model (LSM) to generate a Noah-3.6 parameter input file to be used by LIS (and LVT). In addition to parameter processing, LDT can be used to <em>upscale</em> and <em>downscale</em> ensembles.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Upscale:</strong> generate a multi-member ensemble restart file from a single-member restart file</p>
</div>
<div class="paragraph">
<p><strong>Downscale:</strong> generate a single-member ensemble restart file from a multi-member restart file</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this step you will learn how to use LDT to expand a single-member <strong>restart</strong> file generated by the LIS open-loop (OL) case in Step 2 into a restart file that contains an ensemble of size <em>N</em> (user specified). The ensemble restart file generated in this step will be used in Step 6 to <strong>initialize</strong> the LIS data assimilation (DA) run.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="quoteblock">
<blockquote>
<strong>Restart files</strong> contain all of the initial condition information necessary to restart from a previous simulation.
</blockquote>
<div class="attribution">
&#8212; http://www.cesm.ucar.edu/models/ccsm2.0/csim/UsersGuide/ice_usrdoc/node21.html
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_download_input_and_target_files_3">Download Input and Target Files</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The tar file for this step is approximately <strong>97KB</strong> compressed and <strong>100KB</strong> unpacked. Ensure that you have enough storage available before downloading testcase files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The tar files used in this walkthrough are available on the <a href="https://lis.gsfc.nasa.gov/tests/lis">LIS Testcase website</a>. From within your <code>$WORKING_DIR</code>, download and unpack the compressed tar file containing the inputs and target outputs for Step 3:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% curl -O https://portal.nccs.nasa.gov/lisdata_pub/Tutorials/Web_Version/testcase3_ldt_ensrst_2023.tar.gz
% tar -xzf testcase3_ldt_ensrst_2023.tar.gz -C .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following files and directories were added to your common working directory, <code>$WORKING_DIR</code>:</p>
</div>
<table class="tableblock frame-ends grid-all stripes-odd fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DA_ensrst/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory containing the files below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldt.config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The LDT config file for this step</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_ldtlog.0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target LDT log file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_LIS_EnRST_NOAH36_201801010000.d01.nc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target LDT-generated ensemble restart file ("EnRST") to start the Noah LSM DA run in Step 6</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_the_ldt_configuration_file_2">The LDT Configuration File</h3>
<div class="paragraph">
<p>Review the contents of <code>DA_ensrst/ldt.config</code> to view the configuration settings used for this step:</p>
</div>
<div id="cat-ldtconfig" class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">LDT running mode:                               "Ensemble restart processing"
Processed LSM parameter filename:               ./lis_input.nldas.noah36.d01.nc
...
LIS restart source:                             "LSM"
Ensemble restart generation mode:               "upscale" <i class="conum" data-value="1"></i><b>(1)</b>
Input restart filename:                         ../OL_OUTPUT/SURFACEMODEL/201801/LIS_RST_NOAH36_201801010000.d01.nc
Number of ensembles per tile (input restart):   1 <i class="conum" data-value="2"></i><b>(2)</b>
Number of ensembles per tile (output restart):  12 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This entry tells LDT how to process the <em>ensemble</em> file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Size of input ensemble restart file, in this case a single instance of model states</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Size of upscaled multi-member ensemble restart file, in this case 12 members</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this walkthrough we are using the Noah.3.6 LSM, but these settings can be used to upscale/downscale routing models as well. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">LIS restart source:                             "Routing"
Ensemble restart generation mode:               "upscale"
Input restart filename:                         ./LIS_RST_HYMAP_router_201801010000.d01.bin
Output restart filename:                        ./ensrst.bin
Number of ensembles per tile (input restart):   1
Number of ensembles per tile (output restart):  12</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_ldt_generate_ensemble_restart_file">Run LDT -  Generate Ensemble Restart File</h3>
<div class="paragraph">
<p>You&#8217;re now ready to run LDT:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy your compiled <strong><em>LDT</em></strong> executable into <code>$WORKING_DIR/DA_ensrst</code></p>
</li>
<li>
<p>Run the <strong><em>LDT</em></strong> executable using the provided <code>ldt.config</code> file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ./LDT ldt.config</code></pre>
</div>
</div>
<div class="paragraph">
<p>The run should take a few minutes to complete. If the run aborts, troubleshoot the issue by reviewing any errors printed to the terminal and by viewing the contents of <code>ldtlog.0000</code>. If no errors print to the terminal, verify that the run completed successfully by checking for the following confirmation at the end of the <code>ldtlog.0000</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the terminal reports the error "./LDT: symbol lookup error:", this may be due extraneous modules loaded into your environement that do not allow lis to run properly. View your modules using the command <code>module list</code>.  If extraneous modules are loaded, run <code>module purge</code> to clear your environment and then <code>module load [lisf module file]</code> to load an environment suitable to running LISF.  See the "discover_quick_start" document in the <a href="https://github.com/NASA-LIS/LISF/tree/master/docs" target="_blank" rel="noopener">LISF Users' Guides</a> for more information.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% tail ldtlog.0000
...
 --------------------------------
  Finished LDT run
 --------------------------------</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldt_output_files_2">LDT Output Files</h3>
<div class="paragraph">
<p>During this run, LDT produced one output file named <code>LIS_EnRST_NOAH36_201801010000.d01.nc</code> and placed it into the <code>$WORKING_DIR/DA_ensrst</code> directory.</p>
</div>
<div class="paragraph">
<p>Use <code>ncview</code>, Panoply, Matlab or any other viewing package that supports NetCDF files. Compare what you see with the <em>target</em> version of this output file, also located in <code>$WORKING_DIR/DA_ensrst</code>. Additionally, you can use <code>nccmp</code> to directly compare the contents of the file created by your LDT run and the target. If there are differences between your file and the target file, you can use <code>ncdiff</code> to create a new NetCDF file to visualize the differences.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_4_generate_lsm_ol_cumulative_density_function_based_files_ldt">Step 4: Generate LSM OL Cumulative Density Function-based Files (LDT)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_4">Overview</h3>
<div class="paragraph">
<p>In the previous step you used LDT used to expand a single-member ensemble restart file into a multi-member restart file containing 12 ensemble members. In this step you will use LDT again to generate files that support scaling and bias-correction between the model open-loop states and satellite observations that will be assimilated in Step 6. LDT supports the generation of domain and statistical moment inputs for estimated cumulative distribution functions (CDFs), which can be used when performing the scaling necessary to assimilate certain observations in LIS. The model-based CDF files generated in this step, and those generated in Step 5 for the satellite observations, will be incorporated in the data assimilation run demonstrated in Step 6.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>CDF-based scaling</strong> is used to match the CDF of a given observation to that of the model.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_4_CDF_example.png" alt="step 4 CDF example" width="55%">
</div>
</div>
<div class="paragraph">
<p>CDF generation and CDF-based scaling are performed separately for each grid point. CDF-based scaling corrects all moments of the distribution regardless of its shape and requires enough sampling density to derive these scaling parameters. By comparison, normal deviate-based scaling corrects the first and second moments (e.g., the mean and variance).</p>
</div>
<div class="paragraph">
<p>For more information on this topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reichle, R. H., and Koster, R. D. (2004), Bias reduction in short records of satellite soil moisture, <em>Geophys. Res. Lett.</em>, 31, L19501, <a href="https://doi.org/10.1029/2004GL020938">doi:10.1029/2004GL020938</a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_download_input_and_target_files_4">Download Input and Target Files</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The tar file for this step is approximately <strong>384KB</strong> compressed and <strong>803KB</strong> unpacked. Ensure that you have enough storage available before downloading testcase files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The tar files used in this walkthrough are available on the <a href="https://lis.gsfc.nasa.gov/tests/lis">LIS Testcase website</a>. From within your <code>$WORKING_DIR</code>, download and unpack the compressed tar file containing the inputs and target outputs for Step 4:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% curl -O https://portal.nccs.nasa.gov/lisdata_pub/Tutorials/Web_Version/testcase4_ldt_lsmcdf_2023.tar.gz
% tar -xzf testcase4_ldt_lsmcdf_2023.tar.gz -C .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following files and directories were added to your common working directory <code>$WORKING_DIR</code>:</p>
</div>
<table class="tableblock frame-ends grid-all stripes-odd fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DA_proc_LSM/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory containing the files below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldt.config.noah36_cdf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The LDT config file for this step</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_ldtlog.0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target LDT log file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_cdf_noah36_domain.nc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target LDT-generated Noah LSM <em>domain</em> file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_cdf_noah36.nc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target LDT-generated Noah LSM <em>CDF</em> file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>noah36_cdf.xdf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GrADS description file for viewing <code>*cdf_noah36.nc</code> output and target files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plot_noah36_cdf.gs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GrADS script that plots an X-Y plot of <code>*cdf_noah36.nc</code> output and target files</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_the_ldt_configuration_file_3">The LDT Configuration File</h3>
<div class="paragraph">
<p>Review the contents of <code>DA_proc_LSM/ldt.config.noah36_cdf</code> to view the
configuration settings used for this step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">LDT running mode: "DA preprocessing" <i class="conum" data-value="1"></i><b>(1)</b>
...
DA preprocessing method:            "CDF generation"
DA observation source:              "LIS LSM soil moisture"
Name of the preprocessed DA file:   "cdf_noah36" <i class="conum" data-value="2"></i><b>(2)</b>
Apply anomaly correction to obs:    0
Temporal resolution of CDFs:        "yearly"
Number of bins to use in the CDF:   100
Observation count threshold:        30
Temporal averaging interval:        "1da"
Apply external mask:                0
External mask director:             none
...
LIS soil moisture output model name:        "Noah.3.6"
LIS soil moisture output directory:         ../OL_OUTPUT/
LIS soil moisture output format:            "netcdf"
LIS soil moisture output methodology:       "2d gridspace"
LIS soil moisture output naming style:      "3 level hierarchy"
LIS soil moisture output nest index:        1
LIS soil moisture output map projection:    "latlon"
LIS soil moisture domain lower left lat:    34.375 <i class="conum" data-value="3"></i><b>(3)</b>
LIS soil moisture domain upper right lat:   39.625
LIS soil moisture domain lower left lon:    -102.875
LIS soil moisture domain upper right lon:   -96.125
LIS soil moisture domain resolution (dx):   0.25
LIS soil moisture domain resolution (dy):   0.25</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The "DA preprocessing" mode is used to generate the observation domain and scaling parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A successful run will generate a domain file (i.e., <code>cdf_noah36_domain.nc</code>) and a LSM CDF file (e.g., <code>cdf_noah36.nc</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The LDT run domain should reflect the intended observation grid (projection and resolution). <em>Note that this can differ from the model resolution and projection.</em></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_run_ldt_da_preprocessing_step">Run LDT - DA Preprocessing Step</h3>
<div class="paragraph">
<p>You&#8217;re now ready to run LDT:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy your compiled <strong><em>LDT</em></strong> executable into <code>$WORKING_DIR/DA_proc_LSM</code></p>
</li>
<li>
<p>Run the <strong><em>LDT</em></strong> executable using the provided <code>ldt.config.noah36_cdf</code> file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ./LDT ldt.config.noah36_cdf</code></pre>
</div>
</div>
<div class="paragraph">
<p>The run should take a few minutes to complete. If the run aborts, troubleshoot the issue by reviewing any errors printed to the terminal and by viewing the contents of <code>ldtlog.0000</code>. If no errors print to the terminal, verify that the run completed successfully by checking for the following confirmation at the end of the <code>ldtlog.0000</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the terminal reports the error "./LDT: symbol lookup error:", this may be due extraneous modules loaded into your environement that do not allow lis to run properly. View your modules using the command <code>module list</code>.  If extraneous modules are loaded, run <code>module purge</code> to clear your environment and then <code>module load [lisf module file]</code> to load an environment suitable to running LISF.  See the "discover_quick_start" document in the <a href="https://github.com/NASA-LIS/LISF/tree/master/docs" target="_blank" rel="noopener">LISF Users' Guides</a> for more information.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% tail ldtlog.0000
...
 --------------------------------
  Finished LDT run
 --------------------------------</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldt_output_files_3">LDT Output Files</h3>
<div class="paragraph">
<p>During this run LDT produced a domain file, <code>cdf_noah36_domain.nc</code>, and a LSM CDF file,  <code>cdf_noah36.nc</code> in the <code>DA_proc_LSM</code> directory. If GrADS is installed, use the provided GrADS descriptor files to plot the output shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% grads -lc "plot_noah36_cdf.gs"</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_4_output_fig.png" alt="step 4 output fig">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_5_generate_observations_cdf_based_files_ldt">Step 5: Generate Observations CDF-based Files (LDT)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_5">Overview</h3>
<div class="paragraph">
<p>In this step you will use LDT to generate CDF files from the satellite-based soil moisture (SM) observations collected by NASA&#8217;s <strong>S</strong>oil <strong>M</strong>oisture <strong>A</strong>ctive <strong>P</strong>assive (SMAP) mission. The observation based CDF files generated in this step will be used along with the model CDF files created in Step 4 for the data assimilation run in Step 6.</p>
</div>
</div>
<div class="sect2">
<h3 id="_download_input_and_target_files_5">Download Input and Target Files</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The tar file for this step is approximately <strong>4.6GB</strong> compressed and <strong>9.1GB</strong> unpacked. Ensure that you have enough storage available before downloading testcase files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The tar files used in this walkthrough are available on the <a href="https://lis.gsfc.nasa.gov/tests/lis">LIS Testcase website</a>. From within your <code>$WORKING_DIR</code>, download and unpack the compressed tar file containing the inputs and target outputs for Step 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% curl -O https://portal.nccs.nasa.gov/lisdata_pub/Tutorials/Web_Version/testcase5_ldt_obscdf_2023.tar.gz
% tar -xzf testcase5_ldt_obscdf_2023.tar.gz -C .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following files and directories were added to your common working directory
<code>$WORKING_DIR</code>:</p>
</div>
<table class="tableblock frame-ends grid-all stripes-odd fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RS_DATA.tgz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A tar file containing sample SMAP soil moisture observations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DA_proc_SMAP/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory containing the files below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldt.config.smapobs_cdf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The LDT config file for this step</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_ldtlog.0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target LDT log file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_cdf_smapobs_domain.nc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target LDT-generated Noah LSM <em>domain</em> file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_cdf_smapobs.nc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target LDT-generated Noah LSM <em>CDF</em> file</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The file <code>RS_DATA.tgz</code> should have been recursively unpacked as subdirectory <code>RS_DATA</code> within your <code>$WORKING_DIR</code>. If it was not, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% tar -xzf RS_DATA.tgz -C .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The new directory, <code>RS_DATA</code>, contains sample soil moisture observations from the <a href="https://nsidc.org/data/SPL3SMP/versions/5" target="_blank" rel="noopener"><em>SMAP L3 Radiometer Global Daily 36 km EASE-Grid Soil Moisture</a></em> data product.</p>
</div>
<div class="quoteblock">
<div class="title">SMAP SPL3SMP.005 dataset description:</div>
<blockquote>
This Level-3 (L3) soil moisture product provides a composite of daily estimates of global land surface conditions retrieved by the Soil Moisture Active Passive (SMAP) passive microwave radiometer. SMAP L-band soil moisture data are resampled to a global, cylindrical 36 km Equal-Area Scalable Earth Grid, Version 2.0 (EASE-Grid 2.0).
</blockquote>
</div>
<div class="paragraph">
<p>Use <code>ncview</code> to view the data for 3/1/2017.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ncview RS_DATA/SMAP/SPL3SMP.005/2017.03.01/SMAP_L3_SM_P_20170301_R16010_001.h5</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>ncview</code> opens, click and hold on one of the subdataset buttons under the color bar (e.g., <code>Soil_Moisture_Retrieval_Data_AM (36 vars)</code>) to open the list of variables. Release the mouse button on the variable you would like to plot (e.g., <code>soil_moisture</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to the way the data is formatted, the plot will appear upside down. Click on the <em>Inv P</em> button in the main <code>ncview</code> window to invert the plot.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_5_SMAP_data_viz.png" alt="step 5 SMAP data viz">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_ldt_configuration_file_4">The LDT Configuration File</h3>
<div class="paragraph">
<p>Review the contents of <code>DA_proc_SMAP/ldt.config.smapobs_cdf</code> to view the configuration settings used for this step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">LDT running mode: "DA preprocessing" <i class="conum" data-value="1"></i><b>(1)</b>
...
DA preprocessing method:            "CDF generation"
DA observation source:              "NASA SMAP soil moisture"
Name of the preprocessed DA file:   "./cdf_smapobs" <i class="conum" data-value="2"></i><b>(2)</b>
Apply anomaly correction to obs:    0
Temporal resolution of CDFs:        "yearly" <i class="conum" data-value="3"></i><b>(3)</b>
Number of bins to use in the CDF:   100
Observation count threshold:        30
Temporal averaging interval:        "1da"<i class="conum" data-value="4"></i><b>(4)</b>
Apply external mask:                0
External mask director:             none
...
NASA SMAP soil moisture observation directory: ../RS_DATA/SMAP/SPL3SMP.005  <i class="conum" data-value="5"></i><b>(5)</b>
NASA SMAP soil moisture data designation:      SPL3SMP <i class="conum" data-value="6"></i><b>(6)</b>
NASA SMAP search radius for openwater proximity detection: 3 <i class="conum" data-value="7"></i><b>(7)</b>
SMAP(NASA) soil moisture Composite Release ID (e.g., R16): R16 <i class="conum" data-value="8"></i><b>(8)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>DA preprocessing</em> mode is used to generate the observation domain and scaling parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Prefix of output files (e.g., <code>cdf_smapobs_domain.nc</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Temporal resolution of resultant CDF. Specifies whether to generate lumped (i.e., considering all years and all seasons) CDFs or to stratify CDFs for each calendar month.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Averaging interval used while computing the CDF. In this case, one day.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Relative path to the directory containing SMAP observation data.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specifies which SMAP data product is being used.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Specifies the radius in which LDT searches to detect open water. Then removes all pixels within the radius in the CDF calculations.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Specifies the release ID of the SMAP dataset.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/NASA-LIS/LISF/tree/master/docs">LDT Users' Guide</a> for more information about configuration settings.</p>
</div>
</div>
<div class="sect2">
<h3 id="_run_ldt_da_preprocessing_step_2">Run LDT - DA Preprocessing Step</h3>
<div class="paragraph">
<p>You&#8217;re now ready to run LDT:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy your compiled <strong><em>LDT</em></strong> executable into <code>$WORKING_DIR/DA_proc_SMAP</code></p>
</li>
<li>
<p>Run the <strong><em>LDT</em></strong> executable using the provided <code>ldt.config.smapobs_cdf</code> file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ./LDT ldt.config.smapobs_cdf</code></pre>
</div>
</div>
<div class="paragraph">
<p>The run should take a few minutes to complete. If the run aborts, troubleshoot the issue by reviewing any errors printed to the terminal and by viewing the contents of <code>ldtlog.0000</code>. If no errors print to the terminal, verify that the run completed successfully by checking for the following confirmation at the end of the <code>ldtlog.0000</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the terminal reports the error "./LDT: symbol lookup error:", this may be due extraneous modules loaded into your environement that do not allow lis to run properly. View your modules using the command <code>module list</code>.  If extraneous modules are loaded, run <code>module purge</code> to clear your environment and then <code>module load [lisf module file]</code> to load an environment suitable to running LISF.  See the "discover_quick_start" document in the <a href="https://github.com/NASA-LIS/LISF/tree/master/docs" target="_blank" rel="noopener">LISF Users' Guides</a> for more information.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% tail ldtlog.0000
...
 --------------------------------
  Finished LDT run
 --------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>The run created two new files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cdf_smapobs.nc</code></p>
</li>
<li>
<p><code>cdf_smapobs_domain.nc</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use <code>ncview</code> to plot the <code>SoilMoist_domain</code> variable contained in <code>cdf_smapobs_domain.nc</code>:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_5_SMAP_CDF_domain_viz.png" alt="step 5 SMAP CDF domain viz">
</div>
</div>
<div class="paragraph">
<p>Use <code>nccmp</code> to directly compare the contents of <code>cdf_smapobs_domain.nc</code> with the provided target. They should be identical.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% nccmp -dsf cdf_smapobs_domain.nc target_cdf_smapobs_domain.nc
Files "cdf_smapobs_domain.nc" and "target_cdf_smapobs_domain.nc" are identical.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wrap_up_3">Wrap Up</h3>
<div class="paragraph">
<p>You now have all of the files needed to perform the data assimilation run.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_6_lsm_data_assimilation_da_experiment_lis">Step 6: LSM Data Assimilation (DA) Experiment (LIS)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_6">Overview</h3>
<div class="paragraph">
<p>The <strong>Data Assimilation (DA) subsystem</strong> in LIS is primarily used for state estimation (i.e., correction of model states based on observations) and supports the interoperable use of multiple land surface models, algorithms, and observational data sources. The DA subsystem also provides support for concurrent data assimilation, forward models, radiance assimilation, and observation operators employing advanced data fusion methods (i.e., deep learning). Advanced data assimilation algorithms such as <em>Ensemble Kalman Filter (EnKF)</em> and <em>Ensemble Kalman Smoother (EnKS)</em> are available.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_6_interoperability_fig.png" alt="step 6 interoperability fig">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information:</p>
</div>
<div class="paragraph">
<p>Kumar, S. V., R. H. Reichle, C. D. Peters-Lidard, R. D. Koster, X. Zhan, W. T. Crow, J. B. Eylander, and P. R. Houser, 2008: A Land Surface Data Assimilation Framework using the Land Information System: Description and Applications, <em>Adv. Wat. Res.</em>, 31, 1419-1432, <a href="https://www.sciencedirect.com/science/article/abs/pii/S0309170808000146">doi:10.1016/j.advwatres.2008.01.013</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The DA subsystem outputs a number of diagnostics including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DA innovations, normalized innovations, and ensemble spread</p>
</li>
<li>
<p>Processed/bias-corrected/quality-controlled (QC&#8217;d) observational data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Land Verification Toolkit (LVT) handles automated processing of these outputs.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_6_innovations_var_fig.png" alt="step 6 innovations var fig" width="350px">
</div>
<div class="title">Example DA output: variance of normalized innovations</div>
</div>
</div>
<div class="sect2">
<h3 id="_download_input_and_target_files_6">Download Input and Target Files</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The tar file for this step is approximately <strong>80MB</strong> compressed and <strong>327MB</strong> unpacked. Ensure that you have enough storage available before downloading testcase files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The tar files used in this walkthrough are available on the <a href="https://lis.gsfc.nasa.gov/tests/lis">LIS Testcase website</a>. From within your <code>$WORKING_DIR</code>, download and unpack the compressed tar file containing the inputs and target outputs for Step 6:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% curl -O https://portal.nccs.nasa.gov/lisdata_pub/Tutorials/Web_Version/testcase6_lis_da_2023.tar.gz
% tar -xzf testcase6_lis_da_2023.tar.gz -C .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following directories and files were added to your common working directory <code>$WORKING_DIR</code>:</p>
</div>
<table class="tableblock frame-ends grid-all stripes-odd fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DA_INPUT/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the perturbation files used in the DA run</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lis.config_noah36_smapda</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The LIS config file for this step</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_SMAPDA_OUTPUT/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the target DA output generated by LIS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_log/lislog_smapda.0000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The target LIS log file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_da.xdf</code> &amp; <code>test_da.xdf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GrADS description files to view the output</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This step relies on files downloaded or generated in the previous steps. In addition to the files just downloaded, ensure the following directories are present in <code>$WORKING_DIR</code>:</p>
</div>
<table class="tableblock frame-ends grid-all stripes-odd fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DA_ensrst/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensemble restart files generated in Step 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DA_proc_LSM/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LSM-based CDF files generated in Step 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DA_proc_SMAP/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Observations-based CDF files generated in Step 5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RS_DATA/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Observation data files downloaded in Step 5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INPUT/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NLDAS2 forcing and Noah model files downloaded in Step 2</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_lis_configuration_file_2">The LIS Configuration File</h3>
<div class="paragraph">
<p>Review the contents of <code>lis.config_noah36_smapda</code> to view the configuration settings used for the DA run:</p>
</div>
<div class="listingblock">
<div class="title">Restart options:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">...
Start mode:                                restart <i class="conum" data-value="1"></i><b>(1)</b>
...
Number of ensembles per tile:              12 <i class="conum" data-value="2"></i><b>(2)</b>
...
Noah.3.6 restart file:                    ./DA_ensrst/LIS_EnRST_NOAH36_201801010000.d01.nc <i class="conum" data-value="3"></i><b>(3)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Select "restart" mode to use a restart file (as opposed to "coldstart" mode).</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td># of ensemble members to use (matches ensemble restart file).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Filepath of the 12 member ensemble restart file generated in Step 3.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Data assimilation options:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">...
Number of data assimilation instances:               1

Data assimilation algorithm:                         "EnKF"
Data assimilation set:                               "SMAP(NASA) soil moisture"
Number of state variables:                           4
Data assimilation use a trained forward model:       0
Data assimilation trained forward model output file: none
Data assimilation exclude analysis increments:       0
Data assimilation output interval for diagnostics:  "1da"
Data assimilation number of observation types:       1
Data assimilation output ensemble spread:            1
Data assimilation output processed observations:     1
Data assimilation output innovations:                1
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Scaling strategy options:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">...
Data assimilation scaling strategy:         "CDF matching"
Data assimilation observation domain file:  ./lis_input.nldas.noah36.d01.nc

Bias estimation algorithm:                  "none"
Bias estimation attributes file:            "none"
Bias estimation restart output frequency:
Bias estimation start mode:
Bias estimation restart file:
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Perturbation options:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">...
Perturbations start mode:                 "coldstart"
Perturbations restart output interval:    "1mo"
Perturbations restart filename:           "none"
Apply perturbation bias correction:       0
...
Forcing perturbation algorithm:           "GMAO scheme" <i class="conum" data-value="1"></i><b>(1)</b>
Forcing perturbation frequency:           "1hr"
Forcing attributes file:                  ./DA_INPUT/forcing_attribs.txt
Forcing perturbation attributes file:     ./DA_INPUT/forcing_pert_attribs.txt

State perturbation algorithm:             "GMAO scheme" <i class="conum" data-value="2"></i><b>(2)</b>
State perturbation frequency:             "6hr"
State attributes file:                    ./DA_INPUT/noah_sm_attribs.txt
State perturbation attributes file:       ./DA_INPUT/noah_sm_pertattribs.txt

Observation perturbation algorithm:       "GMAO scheme" <i class="conum" data-value="3"></i><b>(3)</b>
Observation perturbation frequency:       "6hr"
Observation attributes file:              ./DA_INPUT/smap_attribs.txt
Observation perturbation attributes file: ./DA_INPUT/smap_pertattribs.txt</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Forcing perturbation options</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>State perturbation options</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Observation perturbation options</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Observation data options:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">SMAP(NASA) soil moisture data designation:       SPL3SMP
SMAP(NASA) soil moisture data directory:        ./RS_DATA/SMAP/SPL3SMP.005
SMAP(NASA) soil moisture use scaled standard deviation model: 0
SMAP(NASA) soil moisture apply SMAP QC flags:                 1
SMAP(NASA) model CDF file:              ./DA_proc_LSM/cdf_noah36.nc
SMAP(NASA) observation CDF file:        ./DA_proc_SMAP/cdf_smapobs.nc
SMAP(NASA) soil moisture number of bins in the CDF:          100
SMAP(NASA) CDF read option: 0
SMAP(NASA) soil moisture use scaled standard deviation model: 0
SMAP(NASA) soil moisture Composite Release ID: R16</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://github.com/NASA-LIS/LISF/tree/master/docs">LIS Users' Guide</a> for more information about configuration settings.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_perturbation_configuration_files">The Perturbation Configuration Files</h3>
<div class="sect3">
<h4 id="_forcing_perturbations">Forcing Perturbations</h4>
<div class="paragraph">
<p>Forcing variables and perturbation settings are defined in the files named <code>forcing_attribs.txt</code> and <code>forcing_pert_attribs.txt</code>, respectively. The paths to these files are set in the LIS configuration file (see <em>Forcing perturbation options</em> annotation above).</p>
</div>
<div class="listingblock">
<div class="title"><code>forcing_attribs.txt</code> specifies the variables and their ranges:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#nfields
4
#varmin  varmax
Incident Shortwave Radiation Level 001
0.       1300.
Incident Longwave Radiation Level 001
-50.     800.
Rainfall Rate Level 001
0.0      0.001
Near Surface Air Temperature Level 001
220.0    330.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each variable listed in the snippet above, the name is given followed by the min and max values.</p>
</div>
<div class="listingblock">
<div class="title"><code>forcing_pert_attribs.txt</code> specifies perturbation settings:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#ptype   std    std_max   zeromean  tcorr  xcorr ycorr ccorr
Incident Shortwave Radiation Level 001
1        0.20   2.5       1         86400  0     0     1.0  -0.3 -0.5  0.3
Incident Longwave Radiation Level 001
0        30.0   2.5       1         86400  0     0    -0.3   1.0  0.5  0.6
Rainfall Rate Level 001
1        0.50   2.5       1         86400  0     0    -0.5   0.5  1.0  -0.1
Near Surface Air Temperature Level 001
0        0.5    2.5       1         86400  0     0     0.3   0.6  -0.1  1.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, the column headings represent:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ptype</code>: Perturbation type; additive (0) or multiplicative (1)</p>
</li>
<li>
<p><code>std</code>: Standard deviation of perturbations</p>
</li>
<li>
<p><code>std_max</code>: Maximum allowed normalized perturbation relative to <em>N(0, 1)</em></p>
</li>
<li>
<p><code>zeromean</code>: Enforce zero mean across the ensemble; off (0) or on (1)</p>
</li>
<li>
<p><code>tcorr</code>: Temporal correlation scale (in seconds) used in the AR(1) model</p>
</li>
<li>
<p><code>xcorr</code> &amp;  <code>ycorr</code>: Spatial correlation scale (deg)</p>
</li>
<li>
<p><code>ccorr</code>: Cross-correlations with other variables</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_state_perturbations">State Perturbations</h4>
<div class="paragraph">
<p>State variables and perturbation settings are defined in the files named <code>noah_sm_attribs.txt</code> and <code>noah_sm_pertattribs.txt</code>, respectively. The paths to these files are set in the LIS configuration file (see <em>State perturbation options</em> annotation above).</p>
</div>
<div class="listingblock">
<div class="title"><code>noah_sm_attribs.txt</code> specifies perturbation settings:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#nfields
4
#varmin  varmax
Soil Moisture Layer 1
 0.01    0.55
Soil Moisture Layer 2
 0.01    0.55
Soil Moisture Layer 3
 0.01    0.55
Soil Moisture Layer 4
 0.01    0.55</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>noah_sm_pertattribs.txt</code> specifies the variables and their ranges:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#perttype  std    std_max   zeromean  tcorr    xcorr ycorr ccorr
Soil Moisture Layer 1
  0        0.02   0.1       1          10800   0     0     1.0 0.0 0.0 0.0
Soil Moisture Layer 2
  0        0.00   0.1       1          10800   0     0     0.0 1.0 0.0 0.0
Soil Moisture Layer 3
  0        0.00   0.1       1          10800   0     0     0.0 0.0 1.0 0.0
Soil Moisture Layer 4
  0        0.00   0.1       1          10800   0     0     0.0 0.0 0.0 1.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_observation_perturbations">Observation Perturbations</h4>
<div class="paragraph">
<p>Observation variables and perturbation settings are defined in the files named <code>smap_attribs.txt</code> and <code>smap_pertattribs.txt</code>, respectively. The paths to these files are set in the LIS configuration file (see <em>Observation perturbation options</em> annotation above).</p>
</div>
<div class="listingblock">
<div class="title"><code>smap_attribs.txt</code> specifies perturbation settings:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#nfields
1
#varmin  varmax
SMOPS soil moisture
 0.01    1.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>smap_pertattribs.txt</code> specifies the variables and their ranges:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#perttype std  std_max  zeromean  tcorr  xcorr ycorr ccorr
SMOPS soil moisture
 0        0.04 2.5      1         43200  0     0     1.0</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_lis_smap_da_experiment">Run LIS - SMAP DA Experiment</h3>
<div class="paragraph">
<p>You&#8217;re now ready to run LIS to perform the SMAP DA experiment. From <code>$WORKING_DIR</code>, run the LIS executable with the config file for this step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./LIS -f lis.config_noah36_smapda</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using one processor, as we are here, the run will take approximately 30 minutes to complete. If the run fails, troubleshoot the issue by reviewing any errors printed to the terminal and by viewing the contents of <code>log/lislog_smapda.0000</code>. If no errors print to the terminal, verify that the run completed successfully by checking for the following confirmation at the end of <code>log/lislog_smapda.0000</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% tail lislog_smapda.0000
...
LIS Run completed.</code></pre>
</div>
</div>
<div class="paragraph">
<p>View the output of the run using <code>GrADS</code>, <code>ncview</code>, Matlab, or other software. Compare the output generated by this run with the output of the Open-Loop case from Step 2.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_6_output_example.png" alt="step 6 output example">
</div>
<div class="title"><code>SoilMoist_tavg</code> variable in <code>LIS_HIST_201701010600.d01.nc</code></div>
</div>
</div>
<div class="sect2">
<h3 id="_wrap_up_4">Wrap Up</h3>
<div class="paragraph">
<p>You have completed the SMAP Data Assimilation Experiment. In Step 7, you will use the Land Verification Toolkit (LVT) to process the output of the OL and DA runs.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_7_comparison_of_ol_and_da_experiments_lvt">Step 7: Comparison of OL and DA Experiments (LVT)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_7">Overview</h3>
<div class="paragraph">
<p>In this step, you will use the Land Verification Toolkit (LVT) to compare the output generated in the open-loop (Step 2) and data assimilation (Step 6) experiments. Since LVT is a verification and validation software, you will need to plot the output using Python, Matlab, GrADS, etc. LVT offers a range of features and configuration settings so we strongly encourage users to review the <a href="https://github.com/NASA-LIS/LISF/tree/master/docs">LVT Users' Guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_download_input_and_target_files_7">Download Input and Target Files</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
The tar file for this step is approximately <strong>481KB</strong> compressed and <strong>7.2MB</strong> unpacked. Ensure that you have enough storage available before downloading testcase files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The tar files used in this walkthrough are available on the <a href="https://lis.gsfc.nasa.gov/tests/lis">LIS Testcase website</a>. From within your <code>$WORKING_DIR</code>, download and unpack the compressed tar file containing the inputs and target outputs for Step 7:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% curl -O https://portal.nccs.nasa.gov/lisdata_pub/Tutorials/Web_Version/testcase7_lvt_expcomp_2023.tar.gz
% tar -xzf testcase7_lvt_expcomp_2023.tar.gz -C .</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following files and directories were added to your common working directory <code>$WORKING_DIR</code>:</p>
</div>
<table class="tableblock frame-ends grid-all stripes-odd fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lvt.config.ol.da</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The LVT config file for the OL and DA runs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lvt.config_smapDAobs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The LVT config file for the SMAP observations used in the DA run</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>METRICS.TBL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A text file that defines the statistical metric options used by LVT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TS_LOCATIONS.TXT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A text file that specifies the points or regions in the domain where ASCII time series data are to be derived</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_STATS.ol.da/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory containing the target LVT output for the OL and DA runs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_STATS.smapDAobs/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory containing the target LVT output for the SMAP DA obs run</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_log/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory containing target log files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target_fig/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory containing target figures</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plot_TS.m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Matlab script to generate plots of the output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plot_noah36_smapda_littlewashita.plt</code>
 <code>plot_noah36_smapda_fortcobb.plt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gnuplot</code> scripts to generate plots of the output</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_the_lvt_configuration_files">The LVT Configuration Files</h3>
<div class="paragraph">
<p>Review the two LVT configuration files for this step.</p>
</div>
<div class="listingblock">
<div class="title"><code>lvt.config.ol.da</code>:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#Overall driver options
LVT running mode:                       "Data intercomparison"
Map projection of the LVT analysis:     latlon
LVT output format:                      netcdf
LVT output methodology:                 "2d gridspace"

Analysis data sources:               "LIS output"  "LIS output"
...

#     Datastream 1             |            Datastream 2
LVT datastream attributes table::
SoilMoist  1 1  m3/m3   - 1 4     SoilMoist  1 1  m3/m3    - 1 4
RootMoist  1 1  m3/m3   - 1 1     RootMoist  1  1 m3/m3    - 1 1
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>lvt.config.smapDAobs</code>:</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">#Overall driver options
LVT running mode:                       "Data intercomparison"
Map projection of the LVT analysis:     latlon
LVT output format:                      netcdf
LVT output methodology:                 "2d gridspace"

Analysis data sources:                  "LIS DAOBS"  "none"
...

## DATA STREAM INPUTS ....

#Observation
LIS DAOBS output directory:  ./SMAPDA_OUTPUT/DAOBS
LIS DAOBS domain file:       ./lis_input.nldas.noah36.d01.nc
LIS DAOBS instance index:     1
LIS DAOBS use scaled obs:     1
LIS DAOBS output interval:    "15mn"
LIS DAOBS observation type:   "soil moisture"
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_lvt">Running LVT</h3>
<div class="paragraph">
<p>First, run LVT to process the OL vs. DA soil moisture output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ./LVT lvt.config.ol.da</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the run fails, troubleshoot the issue by reviewing any errors printed to the terminal and by viewing the contents of any log files present (e.g., <code>lvtlog*.0000</code>). Otherwise, verify that the run completed successfully by checking for the confirmation message at the end of <code>lvtlog_ol_da.0000</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% tail lvtlog_ol_da.0000
...
[INFO] Finished LVT analysis
 [INFO] --------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output generated by this run can be found in the <code>STATS.ol.da</code> directory and should include point data for "Fort Cobb" and "Little Washita", locations specified in the <code>TS_LOCATIONS.txt</code> file. Compare these files with the target output in <code>target_STATS.ol.da</code> using <code>nccmp</code> to compare the NetCDF files and <code>diff</code> to compare the <code>.dat</code> files.</p>
</div>
<div class="paragraph">
<p>Next, run LVT to process the SMAP DA observations so it can be easily compared with our model output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% ./LVT lvt.config.smapDAobs</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the run fails, troubleshoot the issue by reviewing any errors printed to the terminal and by viewing the contents of any log files present (e.g., <code>lvtlog*.0000</code>). Otherwise, verify that the run completed successfully by checking for the confirmation message at the end of <code>lvtlog.smapDAobs.0000</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">% tail lvtlog.smapDAobs.0000
...
[INFO] Finished LVT analysis
 [INFO] --------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output generated by this run can be found in the <code>STATS.smapDAobs</code> directory and should include point data for "Fort Cobb" and "Little Washita", locations specified in the <code>TS_LOCATIONS.TXT</code> file. Again, compare these files with the target output in <code>target_STATS.smapDAobs</code> using <code>nccmp</code> to compare the NetCDF files and <code>diff</code> to compare the <code>.dat</code> files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plot_the_results">Plot the Results</h3>
<div class="paragraph">
<p>We can now compare the results of our OL and DA runs with the observations we assimilated. Sample scripts to generate plots with <code>gnuplot</code> (<code>plot_noah36_smapda_*.plt</code>) and Matlab (<code>plot_TS.m</code>) are included among the input files.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>gnuplot</code> and Matlab scrips mentioned above expect the existence of a <code>$WORKING_DIR/fig</code> directory as a location to save figures. The scripts will not automatically make this directory. Therefore, prior to running these scripts, you must manually create a <code>$WORKING_DIR/fig</code> directory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_gnuplot_plots"><code>gnuplot</code> Plots</h4>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_7_noah36_ol_da_littlewashita.png" alt="step 7 noah36 ol da littlewashita">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_7_noah36_ol_da_fortcobb.png" alt="step 7 noah36 ol da fortcobb">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_matlab_plots">Matlab Plots</h4>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_7_OL_DA_Little_Washita.png" alt="step 7 OL DA Little Washita">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="./images/step_7_OL_DA_Fort_Cobb.png" alt="step 7 OL DA Fort Cobb">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wrap_up_5">Wrap Up</h3>
<div class="paragraph">
<p>You have now completed the end-to-end public testcase for NASA&#8217;s Land Information System.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.1<br>
Last updated 2023-09-22 18:03:27 UTC
</div>
</div>
</body>
</html>